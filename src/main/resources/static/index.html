<!DOCTYPE html>
<html >
<head>
    <meta charset="UTF-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Asuna的文本小工具</title>
    <link rel="stylesheet" href="./layui/css/layui.css">
    <link rel="shortcut icon" type="image/x-icon" href= "img/cat.ico" media="screen" />
    <!--支持移动设备优先-->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--引入bootstrap的css-->
    <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/style.css">

    <!--引入jquery-->

    <script type="text/javascript" src="bootstrap/js/jquery.js"></script>
    <!--引入bootstrap的js-->
    <script type="text/javascript" src="bootstrap/js/bootstrap.min.js"></script>


    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/iconfont.css">
    <script src="./layui/layui.js"></script>
    <script src="dist/clipboard.js"></script>
    <script type="text/javascript" src="js/sript.js"></script>
    <script type="text/javascript" src="js/qrcode.min.js"></script>
    <script type="text/javascript" src="js/common.js"></script>
    <style>
        .result-box{
            background-color: #F2F2F2;
            padding: 20px;
            margin:0 auto;
        }
        .header{
            margin-bottom: 10px;
            background: #393D49;
        }
        @media screen and (max-width: 750px){
            .layui-main {
            width: auto;
            margin: 0 10px;
        }}
        .avatar{
            float:right;

        }
        .qr-code{
            width: 150px;
            height: 150px;
        }

    </style>
</head>
<body>
    <!--<header class="header">-->
        <!--<div class="layui-main">-->
            <!--<ul class="layui-nav" >-->
                <!--<li class="layui-nav-item layui-this"><a href="index.html">首页</a></li>-->
                <!--<li class="layui-nav-item"><a href="">其他</a></li>-->
                <!--<li class="layui-nav-item"><a href="login.html">去登录</a></li>-->
                <!--<li class="layui-nav-item avatar"><img src="//t.cn/RCzsdCq" class="layui-nav-img" alt=""></li>-->
            <!--</ul>-->
        <!--</div>-->
    <!--</header>-->
    <!--导航栏-->
    <div class="before-pc-header hidden-xs"></div>
    <div class="before-phone-header visible-xs"></div>
    <header>
        <!--PC端可见-->

        <div id="pc-header" class="nav-box hidden-xs">

            <nav>
				<span class="span-box" style="margin-left: 620px;">
					<a class="a-nav" href="index.html">首页</a>

                    <!--未登录状态-->
					<span id="login_register" class="login_register_span"><a href="login.html">登录</a><span style="font-size: 20px;">|</span><a  href="register.html" target="_blank">注册</a></span>

                    <!--已登录状态-->
					<div id="myAccount">
						<a class="myAccount_title_a" href="javascript:;">我的账号</a>
						<span class="down_arrow glyphicon glyphicon-chevron-down"></span>
						<div class="Account_Info">
				    		<div>
								<img src="img/user_img.jpg" width="253px" height="262px" alt=""/>
								<span id="user_name">郑智勇5416456456547</span>
							  	<span id="user_class">[普通用户]</span>
				    		</div>
				    		<hr>
				    		<div class="p_box">
				    			<p id="user_center"><a href="my_home.html">用户中心</a></p>
								<p id="quit" ><a href="javascript:logout()">注销</a></p>
				    		</div>

				      </div>
					</div>
				</span>
            </nav>
        </div>

        <!--手机端可见-->
        <div id="phone-header" class="container visible-xs" style="">
            <div class="row">
                <div class="phone-header-imgbox col-md-4">
                    <div class="brand">
                        <a href="index.html">
                            Asuna<span>Txu</span>
                        </a>
                    </div><!--/.brand -->

                <div class="col-md-offset-2 col-md-6">
                    <nav class="navbar navbar-default" role="navigation" style="margin: 10px auto">
                        <div class="container-fluid">
                            <div class="navbar-header">
                                <button type="button" class="navbar-toggle" data-toggle="collapse"
                                        data-target="#example-navbar-collapse-2">
                                    <span class="sr-only">切换导航</span>
                                    <span class="icon-bar"></span>
                                    <span class="icon-bar"></span>
                                    <span class="icon-bar"></span>
                                </button>
                                <a class="navbar-brand" href="#">Menu</a>
                            </div>
                            <div class="collapse navbar-collapse" id="example-navbar-collapse-2">
                                <ul class="nav navbar-nav navbar-right">
                                    <li><a href="index.html">首页</a></li>
                                    <li id="login_phone"><a href="login.html" >登录</a></li>
                                    <li id="register_phone"><a href="register.html" >注册</a></li>
                                    <li id="account_phone"><a href="my_home.html" >我的账号</a></li>
                                    <li id="quit_phone"><a href="javascript:" >注销</a></li>
                                </ul>
                            </div>

                        </div>
                    </nav>
                </div>
            </div>
        </div>
        </div>



    </header>


    <br>
    <div class="layui-row">
        <div class="layui-col-lg8 layui-col-lg-offset2 layui-col-xs10 layui-col-xs-offset1">
            <div class="layui-form">
                <div class="layui-form-item layui-form-text">
                    <textarea name="message" id="message" placeholder="请输入文本" class="layui-textarea" style="width: 100%; height: 400px" ></textarea>
                </div>
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <select name="operator" id="operator" style="min-width: 300px">
                            <option value="0" selected="selected">去除文本中多余换行</option>
                            <option value="1">将英文标点转换为中文标点</option>
                            <option value="2">去除空格并翻译</option>
                        </select>
                    </div>
                    <blockquote class="layui-elem-quote layui-quote-nm" style="font-size: 14px">
                        本次提交字符量：<span class="layui-badge layui-bg-blue" id="len">0</span> 字符
                    </blockquote>
                </div>
                <div class="layui-form-item">
                    <button class="layui-btn layui-btn-normal" onclick="blankText()">提交处理</button>
                    <button type="reset" class="layui-btn layui-btn" onclick="resetAll()">重置</button>
                    <button class="layui-btn layui-btn-danger" data-clipboard-action="copy" data-clipboard-target="#content" id="copyBtn">复制结果</button>
                </div>
            </div>
            <div class="result-box">
                <div class="layui-card">
                    <div class="layui-card-header">处理结果</div>
                    <div class="layui-card-body" id="content">
                    </div>
                </div>
            </div>
        </div>

        <!--模态框-->
        <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                            &times;
                        </button>
                        <h4 class="modal-title" id="myModalLabel">
                            近期更新 <span style="color: #ff3f77">[Ver.4.0]</span>
                        </h4>
                    </div>
                    <div id="modal_info_box" class="modal-body">
                        在这里添加一些文本
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">知道了
                        </button>

                    </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal -->
        </div>
    </div>
    

    <script>

        function resetAll() {
            var text = document.getElementById("message");
            text.value = "";
        }

        function blankText() {
            var text;
            var xmlHttp;
            var textToBeTrans = document.getElementById("message").value;
            var url;
            var opt = document.getElementById("operator");
            var op = opt.value;
            var t = encodeURIComponent(textToBeTrans);
            switch (op){
                case "0":
                    url = "/blank";
                    break;
                case "1":
                    url = "/toggle";
                    break;
                case "2":
                    if(!checkLogin("uuid")){
                        return;
                    }
                    url = "/trans";
                    break;
            }
            var params = "message=" + t;
            if (getCookie('uuid')) {
                params += "&uuid=" + getCookie('uuid');
            }
            ajaxRequest(url, params);
        }

        function ajaxRequest(url, params) {
            var xmlHttp;
            xmlHttp = new XMLHttpRequest();
            console.log(url);
            console.log(params);
            xmlHttp.onreadystatechange = function (ev) {
                if (xmlHttp.readyState === 4 && xmlHttp.status === 200){
                    var text = xmlHttp.responseText;
                    switch (url) {
                        case "/blank":
                            textHandler(text);
                            break;
                        case "/trans":
                            transHandler(text);
                            break;
                        case "/toggle":
                            toggleHandler(text);
                            break;
                    }
                }
            };
            xmlHttp.open("POST", url, true);
            xmlHttp.setRequestHeader("Content-Type",
                "application/x-www-form-urlencoded");
            xmlHttp.send(params);
        }

        function toggleHandler(data) {
            var content = document.getElementById("content");
            var obj = JSON.parse(data);
            var lenLab = document.getElementById("len");
            content.innerText = obj.data.result;
            lenLab.innerText = obj.data.len;
        }

        function textHandler(data) {
            var cot = document.getElementById("content");
            var obj = JSON.parse(data);
            var lenLab = document.getElementById("len");
            cot.innerText = obj.data.result;
            lenLab.innerText = obj.data.len;
        }

        function transHandler(data) {
            var layer = layui.layer;
            var cot = document.getElementById("content");

            var obj = JSON.parse(data);
            switch (obj.code) {
                case 200:
                    cot.innerText = obj.data.translate;
                    break;
                case 400:
                    layer.msg("待翻译的文本不可为空", {time: 1000});
                    cot.innerText = "";
                    break;
                case 401:
                    layer.msg("请求次数过于频繁", {time: 1000});
                    cot.innerText = "";
                    break;
                case 403:
                    layer.msg("请求的文本过长", {time: 1000});
                    cot.innerText = "";
                    break;
                case 500:
                    layer.msg("查询后端错误", {time: 1000});
                    cot.innerText = "";
                    break;
            }

        }

        function checkLogin(name) {
            if (getCookie(name) === ""){
                layer.msg("请先登录", {time: 1000});
                window.location.href = "login.html";
                return false;
            }
            return true;
        }

        function logout() {
            delCookie('account_name');
            delCookie('uuid');
            window.location.href = 'index.html';
        }
    </script>

    <script>
        //注意：导航 依赖 element 模块，否则无法进行功能性操作
        layui.use(['element', 'form', 'layer'], function(){
            var element = layui.element;
            var layer = layui.layer;
            var clipboard = new ClipboardJS('#copyBtn');
                clipboard.on('success', function (e) {
                    layer.msg('复制成功',{time: 1000});
            });
        
        });
    </script>
</body>
</html>