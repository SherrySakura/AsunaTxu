<!DOCTYPE html>
<html lang="en">

<head>
<!-- META DATA -->
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

<!-- TITLE OF SITE -->
<title>Asuna的文本小工具后台</title>

<!-- favicon -->
<!--<link rel="shortcat icon" href="/favicon.ico" type="image/x-icon">-->

<!--font-awesome.min.css-->
<link rel="stylesheet" href="assets/css/font-awesome.min.css">

<!--linear icon css-->
<link rel="stylesheet" href="https://cdn.linearicons.com/free/1.0.0/icon-font.min.css">

<!--chartist.min.css-->
<link rel="stylesheet" href="assets/chartist/css/chartist.min.css">

<!--bootstrap.min.css-->
<link rel="stylesheet" href="assets/css/bootstrap.min.css">

<!--style.css-->
<link rel="stylesheet" href="assets/css/style.css">

<!--responsive.css-->
<link rel="stylesheet" href="assets/css/responsive.css">

<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>


<![endif]-->

    <script type="text/javascript" src="js/common.js"></script>
</head>

<body>

<!-- wrapper -->
<div id="wrapper">

<!-- navbar -->
<nav class="navbar navbar-default navbar-fixed-top">
	<div class="brand">
		<a href="index.html">
			Asuna<span>Txu</span>
		</a>
	</div><!--/.brand -->
	<div class="container-fluid">
		<div class="navbar-btn">
			<button type="button" class="btn-toggle-fullwidth">
				<i class="lnr lnr-arrow-left-circle"></i>
			</button>
		</div><!--/.navbar-btn -->
		<form class="navbar-form navbar-left">
			<div class="search-group">
				<button type="button"><i data-feather="search"></i></button>
				<input type="text" value="" placeholder="Search..">
			</div><!--/.search-group -->
		</form><!--/form -->
		<div class="navbar-menu">
			<ul class="nav navbar-nav navbar-right">
				<li class="dropdown">
					<a href="#" class="dropdown-toggle" data-toggle="dropdown">
						<img src="assets/images/parson.png" class="img-circle" alt="parson-img">
						<i class="icon-submenu fa fa-angle-down"></i>
					</a>
					<ul class="dropdown-menu">
						<li><a href="account.html"><i class="lnr lnr-user"></i> <span>我的账户</span></a></li>
						<li><a href="#"><i class="lnr lnr-envelope"></i> <span>我的消息</span></a></li>
						<li><a href="#"><i class="lnr lnr-cog"></i> <span>设置</span></a></li>
						<li><a href="#"><i class="lnr lnr-exit"></i> <span>登出</span></a></li>
					</ul>
				</li>
			</ul>
		</div>
	</div><!--/.container-fluid -->
	
</nav><!--/nav -->
<!-- END NAVBAR -->

<!-- LEFT SIDEBAR -->
<div id="sidebar-nav" class="sidebar">
	<div class="sidebar-scroll">
		<nav>
			<ul class="nav">

				<li class="active">
					<a href="my_home.html" >
						<i data-feather="home"></i><span>摘要</span>
					</a>
				</li>

				<li>
					<a href="detail.html">
						<i data-feather="package"></i><span>历史详细</span>
					</a>
				</li>

                <li>
                    <a href="account.html">
                        <i data-feather="package"></i><span>我的账户</span>
                    </a>
                </li>
			</ul>
		</nav>
	</div>

</div>
<!-- END LEFT SIDEBAR -->

<!-- MAIN -->
<div class="main">

	<!-- MAIN CONTENT -->
	<div class="main-content">
		<div class="container-fluid">

			<div class="main-content-head">
				<h2>hello <span style="color: #0099ff" id="userName">Asuna</span></h2>
				<p>欢迎使用Asuna的文本统计后台</p>
			</div>

			<div class="profile-content">
				<div class="row">
					<div class="col-sm-3">
						<div class="profile-state">
							<div class="icon-box">
								<span class="icon-bg icon-bg-1">
									<img src="assets/images/user-icon.png" alt="user-icon">
								</span>
								<h2>一共查询的次数</h2>
							</div><!--/.icon-box-->
							<h3 id="commitCount">0</h3>
							<p id="commitToday">0 今日新增</p>
						</div><!--/.profile-state-->
					</div><!--/.col-->
					<div class="col-sm-3">
						<div class="profile-state">
							<div class="icon-box">
								<span class="icon-bg icon-bg-2">
									<img src="assets/images/add-cart.png" alt="add-cart">
								</span>
								<h2>一共查询的字符数</h2>
							</div><!--/.icon-box-->
							<h3 id="commitCharCount">0</h3>
							<p id="commitCharToday">0 今日新增</p>
						</div><!--/.profile-state-->
					</div><!--/.col-->
					<div class="col-sm-3">
						<div class="profile-state">
							<div class="icon-box">
								<span class="icon-bg icon-bg-3">
									<img src="assets/images/money-icon.png" alt="money-icon">
								</span>
								<h2>一共翻译的字符数</h2>
							</div><!--/.icon-box-->
							<h3 id="transCharCount">0</h3>
							<p id="transCharToday">0 今日新增</p>
						</div><!--/.profile-state-->
					</div><!--/.col-->
					<div class="col-sm-3">
						<div class="profile-state">
							<div class="icon-box">
								<span class="icon-bg icon-bg-4">
									<img src="assets/images/plane-icon.png" alt="deliver-icon">
								</span>
								<h2>剩余可翻译字符量</h2>
							</div><!--/.icon-box-->
							<h3 id="remainChar">0</h3>
							<p id="balance">0 金额剩余</p>
						</div><!--/.profile-state-->
					</div><!--/.col-->
				</div><!--/.row-->

			</div><!--/.profile-content-->

			<div class="row">
				<div class="col-sm-8">
					<div class="box">
						<div class="box-head">
							<h2>最近的历史提交</h2>
						</div><!--/.box-head-->
						<div class="item">
							<div class="item-responsive ">
								<table class="table">
									<thead>
										<tr>
											<th>提交ID</th>
											<th>处理类型</th>
											<th>提交时间</th>
											<th>字符量</th>
											<th>金额</th>
											<th>处理状态</th>
										</tr>
									</thead><!--/thead-->
									<tbody id="tmain">
										<!--<tr>-->
											<!--<td><a href="#">20190718210712663</a></td>-->
											<!--<td>换行处理</td>-->
											<!--<td>2019年7月18日 21:07:12</td>-->
											<!--<td>62</td>-->
											<!--<td>-</td>-->
											<!--<td>-->
												<!--<span class="item-status delivered">已处理</span>-->
											<!--</td>-->
										<!--</tr>-->
									</tbody><!--/tbody-->
								</table><!--/.table-->
							</div><!--/.table-responsive-->
						</div><!--/.item-->
					</div><!--/.box-->
				</div><!--/.col-->
				<div class="col-sm-4">
					<div class="box">
						<div class="box-head">
							<h2>业务使用比例</h2>
						</div><!--/.box-head-->
						<div class="item">
							<div id="product_status" class="ct-chart"></div>
							<div class="statistics-data">
								<div class="stat-income pl0">
									<p><span class="income-dot ps-dot1"></span>换行业务</p>
									<p class="ml10"><span class="income-dot ps-dot2"></span>翻译业务</p>
								</div><!--/.stat-income-->
							</div><!--/.statistics-data-->
						</div><!--/.item-->
					</div><!--/.box-->
				</div><!--/.col-->

			</div><!--/.row-->
		</div><!--/.container-fluid-->
		
	</div><!--/.main-content-->

</div>
<!-- END MAIN -->

<div class="clearfix"></div>

<footer>
	<div class="container-fluid">
		<p>Copyright &copy; 2019.Company name All rights reserved.<a target="_blank" href="http://www.asunapro.com">Asuna的文本小工具</a></p>
	</div>

</footer>

</div>
<!-- END WRAPPER -->
<script>
	var commitCount = document.getElementById("commitCount");
	var commitToday = document.getElementById("commitToday");
	var commitCharCount = document.getElementById("commitCharCount");
	var commitCharToday = document.getElementById("commitCharToday");
	var transCharCount = document.getElementById("transCharCount");
	var transCharToday = document.getElementById("transCharToday");
	var balance = document.getElementById("balance");
	var remainChar = document.getElementById("remainChar");
	var userName = document.getElementById("userName");

	window.onload = function (ev) {
		var uuid = getCookie("uuid");
		console.log(uuid);
		if (uuid === ''){
			alert("请先登录");
			window.location.href = "login.html";
		}else{
		    var un = document.getElementById("userName");
		    un.innerText = getCookie("account_name");
			var url = "all?id=" + uuid;
			var cur = "currentAccount?id=" + uuid;
			var task = "task?uuid=" + uuid;
			var rate = "rate?uuid=" + uuid;
			ajaxGet(url, formatNewest);
			ajaxGet(cur, formatBalance);
			ajaxGet(task, formatTask);
			ajaxGet(rate, formatRate);
		}
	};

	function formatTask(obj) {
	    var tbody = document.getElementById("tmain");
        var length = 0;
        if (obj.data === null){
            length = 0;
        } else {
            length = obj.data.length;
        }
	    if (length === 0){
	        tbody.appendChild(createEmptyRow("-"));
	        return;
        }
	    for (var i = 0; i < length; i++){
	        var row = createRow(obj.data[i]);
	        tbody.appendChild(row);
        }
        console.log(obj);
    }

	function formatNewest(obj) {
		commitCount.innerText = obj.data.commitCount;
		commitToday.innerText = obj.data.commitToday + " 今日新增";
		commitCharCount.innerText = obj.data.commitCharCount;
		commitCharToday.innerText = obj.data.commitCharToday + " 今日新增";
		transCharCount.innerText = obj.data.transCharCount;
		transCharToday.innerText = obj.data.transCharToday + " 今日新增";
	}

	function formatBalance(obj) {
		userName.innerText = obj.data.account;
		var bal = obj.data.balance;
		balance.innerText = bal + " 金额剩余";
		var rate = 46 / 1000000;
		remainChar.innerText = parseInt((bal / rate) + " ");
	}

	function formatRate(obj) {
        var data = {
            series: [obj.data.blank, obj.data.trans]
        };

        var sum = function(a, b) { return a + b };

        new Chartist.Pie('#product_status', data, {
            labelInterpolationFnc: function(value) {
                return Math.round(value / data.series.reduce(sum) * 100) + '%';
            },
            height:"193px",
            plugins: [
                Chartist.plugins.tooltip({
                    currency: '',
                    class: 'line-graph-tooltip',
                    appendToBody: false,
                })
            ]
        });
    }
</script>

<!--jquery-1.12.4.min.js-->
<script  src="assets/js/jquery.min.js"></script>

<!--chartist.min.js-->
<script src="assets/chartist/js/chartist.min.js"></script>
<script src="assets/chartist/js/chartist-tooltip-plugin.js"></script>

<!--bootstrap.min.js-->
<script src="assets/js/bootstrap.min.js"></script>

<!--jquery.slimscroll.min.js-->
<script src="assets/js/jquery.slimscroll.min.js"></script>

<!--feather.min.js-->
<script src="assets/js/feather.min.js"></script>

<!-- DataMaps Plugin Js -->
<script src="assets/js/d3.min.js"></script>
<script src="assets/js/topojson.js"></script>

<!--fontawesome-all.min.js-->
<script src="assets/js/fontawesome-all.min.js"></script>

<!--Custom JS-->
<!--<script src="assets/js/custom.js"></script>-->


</body>
</html>